"use strict";function _classCallCheck(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}function _inherits(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}var _createClass=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}(),_get=function(n,t,i){var e=!0,r,f,o;n:while(e){var u=n,s=t,h=i;if(e=!1,u===null&&(u=Function.prototype),r=Object.getOwnPropertyDescriptor(u,s),r===undefined){if(f=Object.getPrototypeOf(u),f===null)return undefined;n=f;t=s;i=h;e=!0;r=f=undefined;continue n}else return"value"in r?r.value:(o=r.get,o===undefined)?undefined:o.call(h)}},AppAcceso=function(n){function t(n){var i=this;_classCallCheck(this,t);_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,n);this.state={seleccion:{},Lista_usuarios:[],Accesos_url:[],filtro_tabla:"",cargando:1};setTimeout(function(){return i.cargar(0)},1e3);this.obtener_usuarios();this.evAccesos=this.on_acceso.bind(this);this.evEdicion=this.on_edicion.bind(this);this.evActivar=this.on_activar.bind(this);this.evGuardar=this.on_guardar_accesos.bind(this);this.evNombreCompleto=this.on_NombreCompleto.bind(this);this.on_NombreCorto=this.on_NombreCorto.bind(this);this.on_Email_usuario=this.on_Email_usuario.bind(this);this.on_Id_usuario=this.on_Id_usuario.bind(this)}return _inherits(t,n),_createClass(t,[{key:"on_filtro_tabla",value:function(n){var t=n.target.value;this.setState({filtro_tabla:t})}},{key:"on_acceso",value:function(n){this.setState({seleccion:n});document.querySelector("#modal_edicion_url").style.display="flex";this.obtener_accesos_usuario(n.id_usuario)}},{key:"on_edicion",value:function(n){var t={email_usuario:n.email_usuario,foto:n.foto,id_scoi:n.id_scoi,id_usuario:n.id_usuario,nombre_usuario:n.nombre_usuario,nombrecompleto_usuario:n.nombrecompleto_usuario};this.setState({seleccion:t});document.querySelector("#modal_edicion").style.display="flex"}},{key:"on_activar",value:function(n){var t=this.state.Accesos_url,i=n.Estatus.search("C")>-1?"V":"C";t.forEach(function(t){t.Sub_menus.forEach(function(t){var r=t.Accesos.findIndex(function(t){return t.Folio_acceso==n.Folio_acceso});r>-1&&(t.Accesos[r].Estatus=i,console.log(r))})});this.setState({Accesos_url:t})}},{key:"on_guardar_accesos",value:function(){var t=this.state.Accesos_url,n=[];t.forEach(function(t){t.Sub_menus.forEach(function(t){n=n.concat(t.Accesos)})});console.log("Accesos=>",n);this.Actualizar_accesos(n)}},{key:"on_NombreCompleto",value:function(n){var t=this.state.seleccion;t.nombrecompleto_usuario=n.target.value;this.setState({seleccion:t})}},{key:"on_NombreCorto",value:function(n){var t=this.state.seleccion;t.nombre_usuario=n.target.value;this.setState({seleccion:t})}},{key:"on_Email_usuario",value:function(n){var t=this.state.seleccion;t.email_usuario=n.target.value;this.setState({seleccion:t})}},{key:"on_Id_usuario",value:function(n){var t=this.state.seleccion;t.id_scoi=n.target.value;this.setState({seleccion:t})}},{key:"on_guardar_datos_usuario",value:function(){var n=this.state.seleccion;this.guardar(n)}},{key:"llenar_Lista_usuarios",value:function(n){this.setState({Lista_usuarios:n.length>0?n:[]});this.cargar(0)}},{key:"seleccionar_accesos_usuario",value:function(n){this.setState({Accesos_url:n.length>0?n:[]});this.cargar(0)}},{key:"accesos_guardados",value:function(n){n=="OK"?(this.setState({Accesos_url:[],seleccion:{}}),document.querySelector("#modal_edicion_url").style.display="none",mostrar_mensaje("Guardado..","alert-success")):(alert(n),mostrar_mensaje("Error!!!","alert-warning"));this.cargar(0)}},{key:"cargar",value:function(n){this.setState({cargando:n})}},{key:"Usuario_guardado",value:function(){this.obtener_usuarios();document.querySelector("#modal_edicion").style.display="none";mostrar_mensaje("Guardado..","alert-success");this.setState({seleccion:{}});this.cargar(0)}},{key:"obtener_usuarios",value:function(){var n=this;this.cargar(1);fetch("/api/Usuarios_web",{method:"get",headers:{"Content-Type":"application/json"}}).then(function(t){return t.json().then(function(t){return n.llenar_Lista_usuarios(t)})["catch"](function(n){return console.error("error Json=>",n)})})["catch"]()}},{key:"obtener_accesos_usuario",value:function(n){var t=this;this.cargar(1);fetch("/api/Accesos_url?id="+n,{method:"post",headers:{"Content-Type":"application/json"}}).then(function(n){return n.json().then(function(n){return t.seleccionar_accesos_usuario(n)})["catch"](function(n){return console.error("error Json=>",n)})})["catch"](function(n){return console.err("Error=>",n)})}},{key:"Actualizar_accesos",value:function(n){var t=this,i=this.state.seleccion;this.cargar(1);fetch("/api/Accesos_url?id_usuario="+i.id_usuario,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(n){return n.json().then(function(n){return t.accesos_guardados(n)})["catch"](function(n){return console.error("error Json=>",n)})})["catch"](function(n){return console.err("Error=>",n)})}},{key:"guardar",value:function(n){var t=this;this.cargar(1);fetch("/api/Usuarios_web",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(n){return n.json().then(function(n){return n?t.Usuario_guardado():mostrar_mensaje("Error Guardado...","alert-warning")})["catch"](function(n){return console.error("error Json=>",n)})})["catch"]()}},{key:"render",value:function(){var i=this,n=this.state,r=n.seleccion,u=n.Lista_usuarios,f=n.Accesos_url,t=n.filtro_tabla,e=n.cargando,o=u.filter(function(n){return n.id_scoi.toString().search(t)>-1||n.nombre_usuario.toString().toUpperCase().search(t.toUpperCase())>-1||n.nombrecompleto_usuario.toString().toUpperCase().search(t.toUpperCase())>-1});return React.createElement("div",{className:"panel panel-default"},React.createElement("div",{className:"panel-body"},React.createElement("div",null,React.createElement("strong",null,"Filtro"),React.createElement("input",{className:"form-control",type:"text",value:t,placeholder:"Filtro De Usuarios...",onChange:function(n){return i.on_filtro_tabla(n)}})),React.createElement(ListaUsuarios,{Lista:o,evAccesos:this.evAccesos,evEdicion:this.evEdicion}),React.createElement(ModalEdicion,{usuario:r,evNombreCompleto:this.evNombreCompleto,evNombre:this.on_NombreCorto,evEmail:this.on_Email_usuario,evFoilioSCOI:this.on_Id_usuario,guardar:function(){return i.on_guardar_datos_usuario()}}),React.createElement(ModalEdicionUrls,{usuario:r,urls:f,evActivar:this.evActivar,evGuardar:this.evGuardar}),React.createElement(EfectoCargar,{estatus:e})))}}]),t}(React.Component),ListaUsuarios=function(n){var t=n.Lista,i=n.evAccesos,r=n.evEdicion,u=function(n){var t=n.usuario,u=t.id_usuario,f=t.nombre_usuario,e=t.nombrecompleto_usuario,o=t.email_usuario,s=t.id_scoi,h=t.foto;return React.createElement("tr",null,React.createElement("td",null,u),React.createElement("td",null,f),React.createElement("td",null,e),React.createElement("td",null,o),React.createElement("td",null,s),React.createElement("td",null,React.createElement("i",{className:"btn btn-primary ",onClick:function(){return r(t)}},"Editar. ",React.createElement("span",{className:"glyphicon glyphicon-edit"}))),React.createElement("td",null,React.createElement("i",{className:"btn btn-success ",onClick:function(){return i(t)}},"Accesos. ",React.createElement("span",{className:"glyphicon glyphicon-lock"}))))};return React.createElement("div",{id:"contenedor_tabla_usuarios"},React.createElement("table",{className:"table table-striped"},React.createElement("thead",null,React.createElement("tr",{className:"info"},React.createElement("th",null,"Folio"),React.createElement("th",null,"Nombre"),React.createElement("th",null,"Nombre Completo"),React.createElement("th",null,"Correo"),React.createElement("th",null,"SCOI"),React.createElement("th",{colSpan:"2"},"Acciones"))),React.createElement("tbody",null,t.length>0?t.map(function(n){return React.createElement(u,{usuario:n})}):React.createElement("p",null,"Sin Datos A Mostrar..."))))},ModalEdicion=function(n){var t=n.usuario,u=n.evNombreCompleto,f=n.evNombre,e=n.evEmail,o=n.evFoilioSCOI,s=n.guardar,h=t.id_usuario,i=t.id_scoi,r=t.nombre_usuario,c=t.email_usuario;return React.createElement("div",{className:"modal",id:"modal_edicion"},React.createElement("div",{className:"panel panel-primary animate"},React.createElement("div",{className:"panel-heading"},React.createElement("i",{className:"close fa fa-close",onClick:function(){return document.querySelector("#modal_edicion").style.display="none"}}),React.createElement("strong",{className:"glyphicon glyphicon-edit"}," Edicion Usuario.")),React.createElement("div",{className:"panel-body"},React.createElement(VistaUsuario,{usuario:t,edicion:!0,evNombre:u}),React.createElement("div",null,React.createElement("div",{className:"id_usuario"},React.createElement("strong",null,"Folio SCOI"),React.createElement("label",null,React.createElement("input",{type:"text",onChange:o,value:i}))),React.createElement("div",{className:"nombre_usuario"},React.createElement("strong",null,"Nombre"),React.createElement("label",null,React.createElement("input",{type:"text",onChange:f,value:r}))),React.createElement(BtnComprobarNombre,{id:h,nombre:r}),React.createElement("div",{className:"nombre_usuario"},React.createElement("strong",null,"Correo"),React.createElement("label",null,React.createElement("input",{type:"text",onChange:e,value:c}))),React.createElement("span",{onClick:function(){return restaurar_password(i)},style:{float:"right",fontSize:"18px",marginTop:"20px"},className:"btn btn-warning fa fa-history"},"Restaurar Contraseña.")),React.createElement(PieDeModal,{guardar:s,cerrar:"modal_edicion"}))))},ModalEdicionUrls=function(n){var i=n.usuario,t=n.urls,r=n.evActivar,u=n.evGuardar,f=function(n){var t=n.accesos,i=function(n){var t=n.menu,i=t.Menu,r=t.Icon_Menu,f=t.Sub_menus;return[React.createElement("tr",{className:"success"},React.createElement("td",null,React.createElement("i",{className:r}," ")," ",React.createElement("strong",null," ",i," ")),React.createElement("td",null)),f.map(function(n){return React.createElement(u,{sub_menu:n})})]},u=function(n){var t=n.sub_menu,i=t.Sub_menus,r=t.Icon_Sub_menus,u=t.Accesos;return[React.createElement("tr",{className:"active"},React.createElement("td",null,React.createElement("strong",null,React.createElement("i",{style:{marginLeft:"10px"},className:r})," ",i)),React.createElement("td",null)),React.createElement(f,{acceso:u})]},f=function(n){var t=n.acceso,i=function(n){return n.search("C")>-1?"danger fa fa-toggle-off":"success fa fa-toggle-on"};return t.map(function(n){return React.createElement("tr",null,React.createElement("td",null," ",React.createElement("p",{style:{marginLeft:"20px"}}," ",n.Nombre," ")),React.createElement("td",null,React.createElement("i",{style:{borderRadius:"20px"},onClick:function(){return r(n)},className:"btn btn-"+i(n.Estatus)})))})};return React.createElement("table",{className:"table"},React.createElement("tbody",null,t.map(function(n){return React.createElement(i,{menu:n})})))};return React.createElement("div",{className:"modal",id:"modal_edicion_url"},React.createElement("div",{className:"panel panel-success animate"},React.createElement("div",{className:"panel-heading"},React.createElement("i",{className:"close fa fa-close",onClick:function(){return document.querySelector("#modal_edicion_url").style.display="none"}}),React.createElement("strong",{className:"glyphicon glyphicon-lock"}," Edicion Accesos Usuario.")),React.createElement("div",{className:"panel-body"},React.createElement(VistaUsuario,{usuario:i}),React.createElement("h5",null,"Listas Del Urls"),React.createElement("div",{id:"container_accesos_url"},t.length>0?React.createElement(f,{accesos:t}):React.createElement("h4",null,"Sin Accesos A Mostrar...")),React.createElement(PieDeModal,{cerrar:"modal_edicion_url",guardar:u}))))},VistaUsuario=function(n){var t=n.usuario,r=n.edicion,u=n.evNombre,f=t.id_usuario,i=t.nombrecompleto_usuario,e=t.foto;return React.createElement("div",{className:"view_usuario"},React.createElement("img",{src:e,alt:"Foto",className:"img-thumbnail"}),React.createElement("div",{className:"id_usuario"},React.createElement("strong",null,"Folio"),React.createElement("label",null,f)),React.createElement("div",{className:"nombre_usuario"},React.createElement("strong",null,"Nombre"),React.createElement("label",null,r?React.createElement("input",{type:"text",onChange:u,value:i}):i)))},PieDeModal=function(n){var t=n.guardar,i=n.cerrar;return React.createElement("div",{className:"panel-footer"},React.createElement("i",{className:"btn btn-success fa fa-save",onClick:t}," Guardar."),React.createElement("i",{className:"btn btn-default fa fa-close",onClick:function(){return document.querySelector("#"+i).style.display="none"}}," Salir."))},restaurar_password=function(n){fetch("RestaurarPassword?id="+n,{method:"post",headers:{"Content-Type":"application/json"}}).then(function(n){return n.json().then(function(n){return mostrar_mensaje("Nuevo Password : "+n+".","alert-success")})["catch"](function(n){return console.error("error Json=>",n)})})["catch"]()},BuscarUsuario=function(n){function t(){_classCallCheck(this,t);_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,n),_createClass(t,[{key:"render",value:function(){return React.createElement("div",null)}}]),t}(React.Component),BtnComprobarNombre=function(n){function t(n){_classCallCheck(this,t);_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,n);this.state={estado:"",enviando:0};this.conexion=this.conexion.bind(this)}return _inherits(t,n),_createClass(t,[{key:"estado",value:function(){var n=this.state.estado,t=n=="V"?"success fa fa-check":n=="C"?"danger fa fa-close":"default fa fa-external-link";return"btn btn-"+t}},{key:"cambio",value:function(n){this.setState({estado:n,enviando:0})}},{key:"conexion",value:function(){var i=this,n=this.props,t=n.nombre,r=n.id;this.setState({enviando:1});fetch("VerificarNombre?nombre="+t+"&id="+r,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(function(n){return n.json().then(function(n){return i.cambio(n)})})["catch"](function(n){return console.error("Error=>",n)})}},{key:"render",value:function(){return React.createElement("i",{className:this.estado(),onClick:this.conexion},React.createElement("span",null," Comprobar Nombre"))}}]),t}(React.Component);ReactDOM.render(React.createElement(AppAcceso,null),document.querySelector("#root"));